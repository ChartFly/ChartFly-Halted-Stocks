 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halted Stocks Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #333;
            color: white;
        }
        .stock-input {
            margin-bottom: 10px;
            padding: 5px;
            width: calc(100% - 12px);
            display: block;
        }
        .news-container {
            margin-top: 20px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Halted Stocks Tracker</h1>
        <table id="halted-stocks">
            <thead>
                <tr>
                    <th>Stock</th>
                    <th>Reason</th>
                    <th>Halt Time</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="3">Loading halted stocks...</td></tr>
            </tbody>
        </table>
        <h2>Stock Watchlist</h2>
        <input type="text" id="tickerInput" class="stock-input" placeholder="Enter Stock Symbol">
        <button onclick="addTicker()">Add to Watchlist</button>
        <table id="watchlist">
            <thead>
                <tr>
                    <th>Stock</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="2">No stocks added yet.</td></tr>
            </tbody>
        </table>
        <h2>Stock News</h2>
        <div id="news" class="news-container">No news available.</div>
    </div>

    <script>
        const NASDAQ_API_KEY = "YOUR_NASDAQ_API_KEY";
        const HALTED_STOCKS_URL = `https://corsproxy.io/?https://api.nasdaq.com/api/marketmovers/halted`;

        async function fetchHaltedStocks() {
            try {
                const response = await fetch(HALTED_STOCKS_URL);
                if (!response.ok) throw new Error("Failed to fetch halted stocks");
                const data = await response.json();
                displayHaltedStocks(data);
            } catch (error) {
                console.error("Error fetching halted stocks:", error);
            }
        }

        function displayHaltedStocks(data) {
            const tableBody = document.querySelector("#halted-stocks tbody");
            tableBody.innerHTML = "";

            if (data && data.data && Array.isArray(data.data.halts)) {
                data.data.halts.forEach(stock => {
                    const row = `<tr>
                        <td>${stock.symbol || "N/A"}</td>
                        <td>${stock.reason || "N/A"}</td>
                        <td>${stock.haltTime || "N/A"}</td>
                    </tr>`;
                    tableBody.innerHTML += row;
                });
            } else {
                tableBody.innerHTML = "<tr><td colspan='3'>No halted stocks found</td></tr>";
            }
        }

        fetchHaltedStocks();

        const FINNHUB_API_KEY = "YOUR_FINNHUB_API_KEY";
        const watchlist = [];

        function addTicker() {
            const tickerInput = document.getElementById("tickerInput");
            const ticker = tickerInput.value.trim().toUpperCase();

            if (ticker && !watchlist.includes(ticker)) {
                watchlist.push(ticker);
                fetchStockData(ticker);
            }
            tickerInput.value = "";
        }

        async function fetchStockData(ticker) {
            if (!ticker) return; // Prevent invalid fetch requests
            
            const STOCK_API_URL = `https://finnhub.io/api/v1/quote?symbol=${ticker}&token=${FINNHUB_API_KEY}`;
            
            try {
                const response = await fetch(STOCK_API_URL);
                if (!response.ok) throw new Error("Network response was not ok");
                const data = await response.json();
                if (data && data.c) {
                    updateWatchlist(ticker, data);
                } else {
                    console.error("Invalid data received for", ticker, data);
                }
            } catch (error) {
                console.error("Error fetching stock data:", error);
            }
        }

        function updateWatchlist(ticker, data) {
            const tableBody = document.querySelector("#watchlist tbody");

            // Prevent duplicate rows by checking if ticker exists
            const existingRow = tableBody.querySelector(`tr[data-ticker='${ticker}']`);
            if (existingRow) {
                existingRow.innerHTML = `<td>${ticker}</td><td>${data.c ? `$${data.c.toFixed(2)}` : "N/A"}</td>`;
                return;
            }
            
            const row = document.createElement("tr");
            row.setAttribute("data-ticker", ticker);
            row.innerHTML = `<td>${ticker}</td><td>${data.c ? `$${data.c.toFixed(2)}` : "N/A"}</td>`;
            tableBody.appendChild(row);
        }

        async function fetchStockNews(ticker) {
            if (!ticker) return; // Prevent fetching if no ticker is provided
            
            const NEWS_API_URL = `https://finnhub.io/api/v1/company-news?symbol=${ticker}&from=2024-03-01&to=2024-03-06&token=${FINNHUB_API_KEY}`;
            
            try {
                const response = await fetch(NEWS_API_URL);
                if (!response.ok) throw new Error("Network response was not ok");
                const articles = await response.json();
                displayStockNews(articles, ticker);
            } catch (error) {
                console.error("Error fetching stock news:", error);
            }
        }

        function displayStockNews(articles, ticker) {
            const newsContainer = document.getElementById("news");
            newsContainer.innerHTML = `<h3>Latest News for ${ticker}</h3>`;
            
            if (!articles || articles.length === 0) {
                newsContainer.innerHTML += "<p>No relevant news found.</p>";
                return;
            }
            
            articles.slice(0, 5).forEach(article => {
                const newsItem = `<p><strong>${article.headline}</strong><br>${article.summary}</p>`;
                newsContainer.innerHTML += newsItem;
            });
        }
    </script>
</body>
</html>
