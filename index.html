<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halted Stocks Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header {
            width: 100%;
            text-align: center;
            background: #333;
            color: white;
            padding: 10px 0;
            font-size: 20px;
            font-weight: bold;
        }
        .market-status {
            margin-top: 10px;
            font-size: 16px;
            font-weight: bold;
            padding: 5px 15px;
            border-radius: 5px;
            color: white;
        }
        .market-open { background-color: green; }
        .market-closed { background-color: red; }
        .holidays {
            margin-top: 20px;
            padding: 10px;
            background: #fff8e1;
            border: 1px solid #ffd54f;
            width: 90%;
            text-align: center;
        }
        .holidays h3 {
            margin: 0 0 10px 0;
        }
        .holidays ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .holidays li {
            margin: 5px 0;
        }
        .container {
            display: flex;
            justify-content: center;
            width: 90%;
            gap: 20px;
        }
        .table-container {
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            width: 90%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: left;
            font-size: 12px;
        }
        th {
            background: #333;
            color: white;
        }
        .last-update {
            text-align: center;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="header">ChartFly - Educational tools and information for active day traders</div>
    <div id="market-status" class="market-status">Checking market status...</div>
    <div class="holidays">
        <h3>Upcoming U.S. Stock Market Holidays</h3>
        <ul id="holiday-list">
            <li>New Year's Day - January 1</li>
            <li>Martin Luther King Jr. Day - January 20</li>
            <li>Presidents' Day - February 17</li>
            <li>Good Friday - April 18</li>
            <li>Memorial Day - May 26</li>
            <li>Independence Day - July 4</li>
            <li>Labor Day - September 1</li>
            <li>Thanksgiving Day - November 27</li>
            <li>Christmas Day - December 25</li>
        </ul>
    </div>
    <div class="container">
        <div class="table-container">
            <h2>Halted Stocks Tracker</h2>
            <p id="last-update" class="last-update">Loading...</p>
            <table>
                <thead>
                    <tr>
                        <th>Halt Date</th>
                        <th>Halt Time</th>
                        <th>Issue Symbol</th>
                        <th>Issue Name</th>
                        <th>Market</th>
                        <th>Reason Code</th>
                        <th>Definition</th>
                        <th>Pause Threshold Price</th>
                        <th>Resumption Date</th>
                        <th>Resumption Quote Time</th>
                        <th>Resumption Trade Time</th>
                    </tr>
                </thead>
                <tbody id="halted-stocks">
                    <tr><td colspan="11">Loading halted stocks...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        function checkMarketStatus() {
            const now = new Date();
            const options = { timeZone: 'America/New_York', hour12: false, hour: 'numeric', minute: 'numeric' };
            const estTime = now.toLocaleString('en-US', options).split(/:|,/);
            const estHour = parseInt(estTime[0], 10);
            const estMinute = parseInt(estTime[1], 10);
            const marketStatus = document.getElementById("market-status");

            if (
                (estHour > 9 || (estHour === 9 && estMinute >= 30)) &&
                (estHour < 16 || (estHour === 16 && estMinute === 0))
            ) {
                marketStatus.innerText = "Market Open";
                marketStatus.classList.add("market-open");
                marketStatus.classList.remove("market-closed");
                fetchHaltedStocks();
            } else {
                marketStatus.innerText = "Market Closed";
                marketStatus.classList.add("market-closed");
                marketStatus.classList.remove("market-open");
                loadSavedHaltedStocks();
            }
        }

        function saveHaltedStocks(data) {
            localStorage.setItem("haltedStocks", JSON.stringify(data));
            localStorage.setItem("lastUpdate", new Date().toLocaleString());
        }

        function loadSavedHaltedStocks() {
            const savedData = localStorage.getItem("haltedStocks");
            const lastUpdate = localStorage.getItem("lastUpdate");
            if (savedData) {
                document.getElementById("halted-stocks").innerHTML = savedData;
                document.getElementById("last-update").innerText = `Last updated: ${lastUpdate}`;
            }
        }

        async function fetchHaltedStocks() {
            try {
                let response = await fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("https://www.nasdaqtrader.com/rss.aspx?feed=tradehalts"));
                let data = await response.json();
                document.getElementById("halted-stocks").innerHTML = data.contents;
                saveHaltedStocks(data.contents);
            } catch {
                loadSavedHaltedStocks();
            }
        }

        checkMarketStatus();
        setInterval(checkMarketStatus, 60000);
    </script>
</body>
</html>
