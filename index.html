<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halted Stocks Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header {
            width: 100%;
            text-align: center;
            background: #333;
            color: white;
            padding: 10px 0;
            font-size: 20px;
            font-weight: bold;
        }
        .container {
            display: flex;
            justify-content: center;
            width: 90%;
            gap: 20px;
        }
        .table-container {
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            width: 90%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: left;
            font-size: 12px;
        }
        th {
            background: #333;
            color: white;
        }
        .reason-column {
            width: 10%;
            word-wrap: break-word;
        }
        .definition-column {
            width: 60%;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="header">ChartFly - Educational tools and information for active day traders</div>
    <div class="container">
        <div class="table-container">
            <h2>Halted Stocks Tracker</h2>
            <table>
                <thead>
                    <tr>
                        <th>Halt Date</th>
                        <th>Halt Time</th>
                        <th>Issue Symbol</th>
                        <th>Issue Name</th>
                        <th>Market</th>
                        <th class="reason-column">Reason Code</th>
                        <th class="definition-column">Definition</th>
                        <th>Pause Threshold Price</th>
                        <th>Resumption Date</th>
                        <th>Resumption Quote Time</th>
                        <th>Resumption Trade Time</th>
                    </tr>
                </thead>
                <tbody id="halted-stocks">
                    <tr><td colspan="11">Loading halted stocks...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        const reasonDefinitions = {
            "T1": "Trading halted pending the release of significant (or material) news.",
            "T2": "Trading halted to allow investors to assimilate news released.",
            "T3": "News and resumption times; trading set to resume at specified times.",
            "T5": "Single stock trading pause due to rapid price movement.",
            "T6": "Extraordinary market activity likely caused by system misuse or malfunction.",
            "T8": "Trading halted in an ETF due to underlying security issues.",
            "T12": "Trading halted pending receipt of additional information requested by NASDAQ.",
            "H4": "Trading halted due to non-compliance with listing requirements.",
            "H9": "Trading halted because the company is not current in its required filings.",
            "H10": "Trading halted due to non-compliance with listing requirements.",
            "H11": "Trading halted in conjunction with another exchange for regulatory reasons.",
            "LUDP": "Volatility trading pause.",
            "LUDS": "Volatility trading pause - straddle condition.",
            "MWC0": "Market-wide circuit breaker halt - carry over from previous day.",
            "MWC1": "Market-wide circuit breaker halt - Level 1.",
            "MWC2": "Market-wide circuit breaker halt - Level 2.",
            "MWC3": "Market-wide circuit breaker halt - Level 3.",
            "O1": "Operations halt; contact market operations.",
            "IPO1": "Initial Public Offering (IPO) issue not yet trading.",
            "M": "Volatility trading pause due to rapid price movement beyond acceptable limits.",
            "M1": "Trading halted due to a corporate action.",
            "M2": "Quotation not available."
        };

        async function fetchHaltedStocks() {
            try {
                let response = await fetch("https://api.allorigins.win/get?url=" + encodeURIComponent("https://www.nasdaqtrader.com/rss.aspx?feed=tradehalts"));
                let data = await response.json();
                let text = data.contents;
                
                let parser = new DOMParser();
                let xml = parser.parseFromString(text, "text/xml");
                let items = xml.getElementsByTagName("item");
                
                let tableBody = document.getElementById("halted-stocks");
                tableBody.innerHTML = ""; 
                
                if (items.length === 0) {
                    tableBody.innerHTML = "<tr><td colspan='11'>No active trading halts.</td></tr>";
                    return;
                }
                
                for (let item of items) {
                    let desc = item.getElementsByTagName("description")[0]?.textContent || "N/A";
                    let fields = {};
                    desc.split(/<br\s*\/?>/i).forEach(line => {
                        let [key, value] = line.split(':');
                        if (key) fields[key.trim()] = (value || '').trim();
                    });
                    
                    let reasonCode = fields["Reason Code"] || "N/A";
                    let reasonDefinition = reasonDefinitions[reasonCode] || "Definition not available";
                    
                    let row = `<tr>
                        <td>${fields["Halt Date"] || ""}</td>
                        <td>${fields["Halt Time"] || ""}</td>
                        <td>${fields["Issue Symbol"] || ""}</td>
                        <td>${fields["Issue Name"] || ""}</td>
                        <td>${fields["Market"] || ""}</td>
                        <td>${reasonCode}</td>
                        <td>${reasonDefinition}</td>
                        <td>${fields["Pause Threshold Price"] || ""}</td>
                        <td>${fields["Resumption Date"] || ""}</td>
                        <td>${fields["Resumption Quote Time"] || ""}</td>
                        <td>${fields["Resumption Trade Time"] || ""}</td>
                    </tr>`;
                    tableBody.innerHTML += row;
                }
            } catch (error) {
                console.error("Error fetching halted stocks:", error);
                document.getElementById("halted-stocks").innerHTML = "<tr><td colspan='11'>Failed to load data.</td></tr>";
            }
        }
        
        fetchHaltedStocks();
        setInterval(fetchHaltedStocks, 60000);
    </script>
</body>
</html>
